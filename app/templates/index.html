{% extends 'base.html' %}

{% block title %}Главная — Учёт офисного оборудования{% endblock %}

{% block content %}
<h1>Список оборудования</h1>

<form method="get" action="">
    <label>Категория:
        <select name="category">
            <option value="">Все</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if request.args.get('category', '') == (cat.id|string) %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>
    </label>
    <label>Статус:
        <select name="status">
            <option value="">Все</option>
            <option value="В эксплуатации" {% if request.args.get('status') == 'В эксплуатации' %}selected{% endif %}>В эксплуатации</option>
            <option value="На ремонте" {% if request.args.get('status') == 'На ремонте' %}selected{% endif %}>На ремонте</option>
            <option value="Списано" {% if request.args.get('status') == 'Списано' %}selected{% endif %}>Списано</option>
        </select>
    </label>
    <label>Дата покупки:
        <input type="date" name="date_from" value="{{ request.args.get('date_from', '') }}"> — <input type="date" name="date_to" value="{{ request.args.get('date_to', '') }}">
    </label>
    <button type="submit">Фильтровать</button>
</form>

<table>
    <thead>
        <tr>
            <th>Название</th>
            <th>Инвентарный номер</th>
            <th>Категория</th>
            <th>Статус</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for eq in equipment_list %}
        <tr>
            <td>{{ eq.name }}</td>
            <td>{{ eq.inventory_number }}</td>
            <td>{{ eq.category_name }}</td>
            <td>{{ eq.status_display }}</td>
            <td>
                <a href="{{ url_for('view_equipment', id=eq.id) }}" class="btn btn-info">Просмотр</a>
                {% if current_user.is_authenticated and current_user.role.name == 'admin' %}
                    <a href="#" class="btn btn-warning">Редактировать</a>
                    <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ eq.id }}">Удалить</button>
                    
                {% elif current_user.is_authenticated and current_user.role.name == 'tech' %}
                    <a href="#">➕ Обслуживание</a>
                {% endif %}
            </td>
        </tr>
        <div class="modal fade" id="deleteModal{{ eq.id }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Подтверждение</h5>
                    </div>
                    <div class="modal-body">
                        Вы уверены, что хотите удалить {{ eq.name }}?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Нет</button>
                        <form action="{{ url_for('delete_equipment', id=eq.id) }}" method="POST">
                            <button type="submit" class="btn btn-danger">Да</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <tr><td colspan="5">Нет оборудования</td></tr>        
        {% endfor %}
    </tbody>
</table>

<div class="pagination">
    {% if pagination.pages > 1 %}
        {% for page_num in pagination.iter_pages() %}
            {% if page_num %}
                {% if page_num == pagination.page %}
                    <strong>{{ page_num }}</strong>
                {% else %}
                    <a href="?page={{ page_num }}{% if request.args.get('category') %}&category={{ request.args.get('category') }}{% endif %}{% if request.args.get('status') %}&status={{ request.args.get('status') }}{% endif %}{% if request.args.get('date_from') %}&date_from={{ request.args.get('date_from') }}{% endif %}{% if request.args.get('date_to') %}&date_to={{ request.args.get('date_to') }}{% endif %}">{{ page_num }}</a>
                {% endif %}
            {% else %}
                ...
            {% endif %}
        {% endfor %}
    {% endif %}
</div>





{% endblock %}